<Window x:Class="TaskMaster.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TaskMaster.ViewModels"
        Title="TaskMaster - WPF TaskSpec Generator" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Bar -->
        <Border Grid.Row="0" Background="#F0F0F0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Content="Project:" VerticalAlignment="Center" FontWeight="Bold"/>
                <ComboBox Grid.Column="1" ItemsSource="{Binding Projects}" SelectedItem="{Binding SelectedProject}"
                          DisplayMemberPath="Name" VerticalAlignment="Center"/>
                <Button Grid.Column="2" Content="Add Project" Command="{Binding CreateProjectCommand}"
                        VerticalAlignment="Center" Margin="10,0,0,0"/>

                <Label Grid.Column="4" Content="Repo Root:" VerticalAlignment="Center" FontWeight="Bold"/>
                <TextBox Grid.Column="5" Text="{Binding RepoRoot}" VerticalAlignment="Center"/>
                <Button Grid.Column="6" Content="Browse..." Command="{Binding BrowseRepoRootCommand}"
                        VerticalAlignment="Center" Margin="10,0,0,0"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Pane - Form -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Padding="10">
                <StackPanel>
                    <!-- Basic Info -->
                    <GroupBox Header="Basic Information" Margin="0,0,0,10">
                        <StackPanel>
                            <Label Content="Title:*"/>
                            <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"/>

                            <Label Content="Summary:*"/>
                            <TextBox Text="{Binding Summary, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="80"/>

                            <Label Content="CLAUDE.md Path:"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" Text="{Binding ClaudeMdPath, UpdateSourceTrigger=PropertyChanged}"/>
                                <Button Grid.Column="1" Content="Browse..." Command="{Binding BrowseClaudeMdPathCommand}"
                                        Width="80" Margin="5,0,0,0"/>
                            </Grid>
                        </StackPanel>
                    </GroupBox>

                    <!-- Validation Errors -->
                    <GroupBox Header="Validation" Margin="0,0,0,10"
                              Visibility="{Binding ValidationErrors, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBlock Text="{Binding ValidationErrors}" Foreground="Red" FontWeight="Bold" TextWrapping="Wrap"/>
                    </GroupBox>

                    <!-- Inference Controls -->
                    <GroupBox Header="Spec Generation" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="{Binding InferenceStatus}" FontStyle="Italic" Margin="0,0,0,10"/>

                            <StackPanel Orientation="Horizontal">
                                <Button Content="Infer Spec Fields" Command="{Binding InferSpecCommand}"
                                        Margin="0,0,10,0"/>
                                <TextBlock Text="✓ Ready" Foreground="Green" VerticalAlignment="Center"
                                           Visibility="{Binding IsInferenceValid, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <TextBlock Text="⚠ Stale - Re-run inference" Foreground="Orange" VerticalAlignment="Center"
                                           Visibility="{Binding IsInferenceStale, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <!-- Inferred Fields -->
                    <GroupBox Header="Inferred Fields" Margin="0,0,0,10"
                              IsEnabled="{Binding IsInferenceValid}">
                        <StackPanel>
                            <Label Content="Type:"/>
                            <ComboBox SelectedValue="{Binding Type}">
                                <ComboBoxItem Content="feature"/>
                                <ComboBoxItem Content="bug"/>
                                <ComboBoxItem Content="enhancement"/>
                                <ComboBoxItem Content="refactor"/>
                                <ComboBoxItem Content="docs"/>
                            </ComboBox>

                            <Label Content="Scope Paths (JSON):"/>
                            <TextBox Text="{Binding ScopePaths, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="60" FontFamily="Consolas"/>

                            <Label Content="Acceptance Criteria (JSON):"/>
                            <TextBox Text="{Binding AcceptanceCriteria, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="80" FontFamily="Consolas"/>

                            <Label Content="Test Plan (JSON):"/>
                            <TextBox Text="{Binding TestPlan, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="60" FontFamily="Consolas"/>

                            <Label Content="Required Docs (JSON):"/>
                            <TextBox Text="{Binding RequiredDocs, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="60" FontFamily="Consolas"/>

                            <Label Content="Non-Goals (optional):"/>
                            <TextBox Text="{Binding NonGoals, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="60"/>

                            <Label Content="Notes (optional):"/>
                            <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                     TextWrapping="Wrap" AcceptsReturn="True" Height="60"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Suggested Tasks -->
                    <GroupBox Header="Suggested Tasks" Margin="0,0,0,10"
                              Visibility="{Binding SuggestedTasks, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBox Text="{Binding SuggestedTasks, UpdateSourceTrigger=PropertyChanged}"
                                 TextWrapping="Wrap" AcceptsReturn="True" Height="100" FontFamily="Consolas" IsReadOnly="True"/>
                    </GroupBox>

                    <!-- Next Steps -->
                    <GroupBox Header="Suggested Next Steps" Margin="0,0,0,10"
                              Visibility="{Binding NextSteps, Converter={StaticResource NullToVisibilityConverter}}">
                        <TextBox Text="{Binding NextSteps, UpdateSourceTrigger=PropertyChanged}"
                                 TextWrapping="Wrap" AcceptsReturn="True" Height="100" FontFamily="Consolas" IsReadOnly="True"/>
                    </GroupBox>

                    <!-- Actions -->
                    <GroupBox Header="Actions" Margin="0,0,0,10">
                        <StackPanel>
                            <Button Content="Save Spec" Command="{Binding SaveSpecCommand}" Margin="0,0,0,10"
                                    Background="#4CAF50" Foreground="White" FontWeight="Bold"/>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <Button Content="Run Panel" Command="{Binding RunPanelCommand}" Margin="0,0,10,0"
                                        Background="#2196F3" Foreground="White"/>
                                <Button Content="Run Update" Command="{Binding RunUpdateCommand}"
                                        Background="#FF9800" Foreground="White"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <Button Content="Export Catalog" Command="{Binding ExportCatalogCommand}" Margin="0,0,10,0"/>
                                <Button Content="Setup Project" Command="{Binding SetupProjectStructureCommand}" Margin="0,0,10,0"
                                        Background="#8BC34A" Foreground="White" ToolTip="Generate project structure for TaskMaster"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <Button Content="Export Template" Command="{Binding ExportProjectTemplateCommand}" Margin="0,0,10,0"
                                        ToolTip="Export project as template for other repositories"/>
                                <Button Content="Import Template" Command="{Binding ImportProjectTemplateCommand}" Margin="0,0,10,0"
                                        ToolTip="Import project template from file"/>
                                <Button Content="Show Logs" Command="{Binding ShowLogsCommand}"
                                        ToolTip="Open application log file for debugging"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Right Pane - Preview -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Label Grid.Row="0" Content="Markdown Preview" FontWeight="Bold" Background="#F5F5F5" Padding="10"/>

                <TextBox Grid.Row="1" Text="{Binding MarkdownPreview, Mode=OneWay}"
                         IsReadOnly="True" FontFamily="Consolas" FontSize="11"
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                         Background="#FAFAFA" Margin="10"/>
            </Grid>
        </Grid>
    </Grid>
</Window>